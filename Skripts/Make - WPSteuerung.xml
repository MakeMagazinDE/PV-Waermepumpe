<xml xmlns="https://developers.google.com/blockly/xml">
  <variables>
    <variable id="1|QG.GkR.?Y6p=i^f4)5">evccLoadPointID</variable>
    <variable id="C8mTNM`|x~:|Orh++t0y">HSMaxWasserTemp</variable>
    <variable id="4`clKl%KG#^(bLX;,Xtp">HSPhase1MinAmp</variable>
    <variable id="L$T!0K2-^(e~!qBXBi0s">HSPhase1Power</variable>
    <variable id="{mX-z64|*k%oT%HqOzhw">maximaleLeistungInAmp</variable>
    <variable id="1OvO)X~V14KD:xfok%T!">HSPhase2MinAmp</variable>
    <variable id="~xer5k=`D^{c4_=4VeGS">HSPhase2Power</variable>
    <variable id="a=Typ3-}y,q=i7Ycjl4c">HSPhase3MinAmp</variable>
    <variable id="I4s6=lWR3f-*4+.4|9xe">HSPhase3Power</variable>
    <variable id="ZYeI5,BS5,V;#%*nOn-D">shellyPhase1</variable>
    <variable id="qFPXGo7y[`5eTSBChG-+">shellyPhase2</variable>
    <variable id="kxHc7?.FxviTyh[T8:Ta">shellyPhase3</variable>
  </variables>
  <block type="procedures_callnoreturn" id=",wt[gg2=7dUgiiYwYc(b" x="613" y="-1612">
    <mutation name="starteSkript"></mutation>
  </block>
  <block type="procedures_defnoreturn" id="Wf8=i~9c#Cz7+t/47^kW" x="738" y="-1612">
    <field name="NAME">starteSkript</field>
    <comment pinned="false" h="80" w="160">Beschreibe diese Funktion …</comment>
    <statement name="STACK">
      <block type="comment" id="Al0bNMUh]|a#3.6o_UKI">
        <field name="COMMENT">Hier wird die LoadPoint ID / &amp;#10;Ladepunkt Nr der Wärmepumpe aus&amp;#10;evcc erwartet.&amp;#10;evcc nummeriert alle Ladepunkt durch - einfach die&amp;#10;Ladepunkte von links nach rechts zählen und&amp;#10;die Zahl hier angeben.</field>
        <next>
          <block type="variables_set" id="[#8;}x4:@,q!hlW+.P%]">
            <field name="VAR" id="1|QG.GkR.?Y6p=i^f4)5">evccLoadPointID</field>
            <value name="VALUE">
              <block type="math_number" id=";Me,u8F=MTPpCdrez?$g">
                <field name="NUM">3</field>
              </block>
            </value>
            <next>
              <block type="procedures_callnoreturn" id="GzBsEK(#j%6QerW@SjAy">
                <mutation name="setzeEVCCLimit"></mutation>
                <next>
                  <block type="procedures_callnoreturn" id="4@pWuk(UL.68C4``QT+$">
                    <mutation name="setzePVZielTemp"></mutation>
                    <next>
                      <block type="procedures_callnoreturn" id="f#jSKm6ognTn%2{79QiZ">
                        <mutation name="virtuelleWallbox"></mutation>
                      </block>
                    </next>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </next>
      </block>
    </statement>
  </block>
  <block type="procedures_defnoreturn" id="iyn+bO~=FG[|U)z%y1E=" x="1462" y="-1612">
    <field name="NAME">setzePVZielTemp</field>
    <comment pinned="false" h="80" w="160">Describe this function...</comment>
    <statement name="STACK">
      <block type="comment" id="||dZ6ed~]+aC_Sb2MxWm">
        <field name="COMMENT">evcc nimmt im "Heizungsbetrieb" als Standard&amp;#10;Temperatur 100 Grad an. Der Wert liegt&amp;#10;meist über dem gewünshten Wert. &amp;#10;Damit der Wert nicht auf 100 "springt" wird&amp;#10;das Skript die gewünschte Zieltemperatur&amp;#10;regelmäßig prüfen und auf den gewünschten&amp;#10;Standardwert setzen.</field>
        <next>
          <block type="on_ext" id="w.a8Sk2~z!rY(B^=S/=L">
            <mutation xmlns="http://www.w3.org/1999/xhtml" items="1"></mutation>
            <field name="CONDITION">any</field>
            <field name="ACK_CONDITION"></field>
            <value name="OID0">
              <shadow type="field_oid" id="H(Ie%I:H)I%Z?L7;buD(">
                <field name="oid">0_userdata.0.wp.evcc.mode</field>
              </shadow>
            </value>
            <statement name="STATEMENT">
              <block type="procedures_callnoreturn" id="elYM~YR8]YIw6Cv(e@$s">
                <mutation name="setzePVZielTemp"></mutation>
              </block>
            </statement>
            <next>
              <block type="comment" id="N`Wc[=[g^cHK*=QSa]G}">
                <field name="COMMENT">evcc erlaubt im Webinterface die maximale&amp;#10;Temperatur des Warmwasserspeichers zu &amp;#10;setzten.&amp;#10;Bei Wärmepumpen kann nicht jede&amp;#10;Temperatur erreicht werden - bei mir sind&amp;#10;dieses 55 Grad. Bei höheren Werten wird&amp;#10;die Nutzereingabe auf den Maximalwert&amp;#10;zurückgesetzt.</field>
                <next>
                  <block type="on_ext" id=";jUbSMVYasSZrXB-L{:%">
                    <mutation xmlns="http://www.w3.org/1999/xhtml" items="1"></mutation>
                    <field name="CONDITION">any</field>
                    <field name="ACK_CONDITION"></field>
                    <value name="OID0">
                      <shadow type="field_oid" id="eLG[{CHj3A7@`[Lbu]rA">
                        <field name="oid">0_userdata.0.wp.evcc.pvZielTemp</field>
                      </shadow>
                    </value>
                    <statement name="STATEMENT">
                      <block type="debug" id="`ZI$+^ezCy.cc88z)0[g">
                        <field name="Severity">info</field>
                        <value name="TEXT">
                          <shadow type="text" id="39iV(7Lk4*JMR%#U^Ma/">
                            <field name="TEXT">test</field>
                          </shadow>
                          <block type="text_join" id="NX6O^p#uKv+/EzoYb:3,">
                            <mutation items="3"></mutation>
                            <value name="ADD0">
                              <block type="text" id="wbEzfh)%`9tkn0wbHD:`">
                                <field name="TEXT">PV Ziel Temperatur mit </field>
                              </block>
                            </value>
                            <value name="ADD1">
                              <block type="get_value_var" id="iy}+iylfaTucYSq8ht;*">
                                <field name="ATTR">val</field>
                                <value name="OID">
                                  <shadow type="field_oid" id=")6Uvu,pKVMSkqLO:VLOz">
                                    <field name="oid">0_userdata.0.wp.evcc.pvZielTemp</field>
                                  </shadow>
                                </value>
                              </block>
                            </value>
                            <value name="ADD2">
                              <block type="text" id="a7JK~ufl5[69gdyWT%Kj">
                                <field name="TEXT"> angegeben.</field>
                              </block>
                            </value>
                          </block>
                        </value>
                        <next>
                          <block type="controls_if" id="hy0eY~3qw4aeXQDppoa]">
                            <value name="IF0">
                              <block type="logic_compare" id=":!,:UN*D#`6]%}m1L,B$">
                                <field name="OP">GT</field>
                                <value name="A">
                                  <block type="get_value_var" id="l?(S#1/Sa_KALKf`OF~x">
                                    <field name="ATTR">val</field>
                                    <value name="OID">
                                      <shadow type="field_oid" id="tS:l)r|kvio%0B^y9u][">
                                        <field name="oid">0_userdata.0.wp.evcc.pvZielTemp</field>
                                      </shadow>
                                    </value>
                                  </block>
                                </value>
                                <value name="B">
                                  <block type="get_value" id="S3uM)P/Zt9s!g2#rEc$d">
                                    <field name="ATTR">val</field>
                                    <field name="OID">0_userdata.0.wp.steuerung.maxTemp</field>
                                  </block>
                                </value>
                              </block>
                            </value>
                            <statement name="DO0">
                              <block type="comment" id="gjpSt%#:}x}eS1dTsvj%">
                                <field name="COMMENT">evcc erwartet alle Werte, die an evcc übermittelt&amp;#10;werden unter dem Suffix "/set". Leider kommt&amp;#10;der mqtt client von ioBroker damit nicht &amp;#10;zuverlässig klar. Daher erfolgt an dieser Stelle &amp;#10;ein direkter mqtt Befehl anstatt die "Magie" von&amp;#10;ioBroker zu nutzen.</field>
                                <next>
                                  <block type="timeouts_wait" id=",[e*^sgOV:GF[LN^:3#k">
                                    <field name="DELAY">1000</field>
                                    <field name="UNIT">ms</field>
                                    <next>
                                      <block type="update" id="tY1,v/6ajBUioT(Ijm4X">
                                        <mutation xmlns="http://www.w3.org/1999/xhtml" delay_input="false"></mutation>
                                        <field name="OID">0_userdata.0.wp.evcc.pvZielTemp</field>
                                        <field name="WITH_DELAY">FALSE</field>
                                        <value name="VALUE">
                                          <block type="get_value" id="1JAadeZ3Qp-$^CBQ/0J_">
                                            <field name="ATTR">val</field>
                                            <field name="OID">0_userdata.0.wp.steuerung.maxTemp</field>
                                          </block>
                                        </value>
                                        <next>
                                          <block type="debug" id="U6BQ9*..w8:jbWR7W[23">
                                            <field name="Severity">info</field>
                                            <value name="TEXT">
                                              <shadow type="text" id="39iV(7Lk4*JMR%#U^Ma/">
                                                <field name="TEXT">test</field>
                                              </shadow>
                                              <block type="text_join" id="JQrhu(TBJsmypNZRZ$jg">
                                                <mutation items="5"></mutation>
                                                <value name="ADD0">
                                                  <block type="text" id="~uTas_!xvj%7~7?srhp7">
                                                    <field name="TEXT">Temperatur mit </field>
                                                  </block>
                                                </value>
                                                <value name="ADD1">
                                                  <block type="get_value_var" id="Ax+qy7)[ScjD^n$prXAC">
                                                    <field name="ATTR">val</field>
                                                    <value name="OID">
                                                      <shadow type="field_oid" id="CkqZ/!z;#$8[j/NK3[Y(">
                                                        <field name="oid">0_userdata.0.wp.evcc.pvZielTemp</field>
                                                      </shadow>
                                                    </value>
                                                  </block>
                                                </value>
                                                <value name="ADD2">
                                                  <block type="text" id="7Ifyx3$VK;bP2a,nB%Fx">
                                                    <field name="TEXT"> zu hoch. Setzte pvZielTemp auf maxTemp und sende  </field>
                                                  </block>
                                                </value>
                                                <value name="ADD3">
                                                  <block type="get_value_var" id="jsE+GOrQ%;5PVSxFyVtP">
                                                    <field name="ATTR">val</field>
                                                    <value name="OID">
                                                      <shadow type="field_oid" id="FBl1lVDS8MjK5F}odkFU">
                                                        <field name="oid">0_userdata.0.wp.steuerung.maxTemp</field>
                                                      </shadow>
                                                    </value>
                                                  </block>
                                                </value>
                                                <value name="ADD4">
                                                  <block type="text" id="0-}6Eb!:H-oa0bWxC1nW">
                                                    <field name="TEXT"> per mqtt an evcc.</field>
                                                  </block>
                                                </value>
                                              </block>
                                            </value>
                                          </block>
                                        </next>
                                      </block>
                                    </next>
                                  </block>
                                </next>
                              </block>
                            </statement>
                            <next>
                              <block type="comment" id="8eF6RkQcmmaj=hlXjNId">
                                <field name="COMMENT">Ist das Überheizen aktiv, sorge dafür, dass der&amp;#10;neue Zielwert / Sollwert an die Wärmepumpe&amp;#10;gesendet wird.</field>
                                <next>
                                  <block type="update" id="[3G!)UWL0Acp/H,YbBqh">
                                    <mutation xmlns="http://www.w3.org/1999/xhtml" delay_input="false"></mutation>
                                    <field name="OID">0_userdata.0.wp.steuerung.pvZielTemp</field>
                                    <field name="WITH_DELAY">FALSE</field>
                                    <value name="VALUE">
                                      <block type="get_value" id="$PolWBxSufh`+W23kR4)">
                                        <field name="ATTR">val</field>
                                        <field name="OID">0_userdata.0.wp.evcc.pvZielTemp</field>
                                      </block>
                                    </value>
                                    <next>
                                      <block type="procedures_callnoreturn" id="7{/p}{?4=N.H)M}zSfxL">
                                        <mutation name="setzeEVCCLimit"></mutation>
                                        <next>
                                          <block type="controls_if" id="@SN*Ib!HGjqHEZS].p@)">
                                            <value name="IF0">
                                              <block type="logic_compare" id="reLu[i{W,GstG+Hu@W_H">
                                                <field name="OP">EQ</field>
                                                <value name="A">
                                                  <block type="get_value_var" id="]]0wemb(auymDDw|A~b^">
                                                    <field name="ATTR">val</field>
                                                    <value name="OID">
                                                      <shadow type="field_oid" id="MEU0ktLL/ieFO3Dx`v[T">
                                                        <field name="oid">0_userdata.0.wp.evcc.aktiv</field>
                                                      </shadow>
                                                    </value>
                                                  </block>
                                                </value>
                                                <value name="B">
                                                  <block type="logic_boolean" id="n:)G[XDlCadk0H0]A:1S">
                                                    <field name="BOOL">TRUE</field>
                                                  </block>
                                                </value>
                                              </block>
                                            </value>
                                            <statement name="DO0">
                                              <block type="debug" id="S+.1s6ldZ^YWc/7kyGQO">
                                                <field name="Severity">info</field>
                                                <value name="TEXT">
                                                  <shadow type="text" id="39iV(7Lk4*JMR%#U^Ma/">
                                                    <field name="TEXT">test</field>
                                                  </shadow>
                                                  <block type="text_join" id="}cC`X5AtlV.0FhmoBJAH">
                                                    <mutation items="2"></mutation>
                                                    <value name="ADD0">
                                                      <block type="text" id="0O76[xt56Km|Y-NjSnAh">
                                                        <field name="TEXT">Überheizen aktiv, ändere Zieltemperatur auf: </field>
                                                      </block>
                                                    </value>
                                                    <value name="ADD1">
                                                      <block type="get_value_var" id="LUBiG.Sq(_d|KG`;ifX.">
                                                        <field name="ATTR">val</field>
                                                        <value name="OID">
                                                          <shadow type="field_oid" id="G12tkP2H`?s+rEb,0Eym">
                                                            <field name="oid">0_userdata.0.wp.steuerung.pvZielTemp</field>
                                                          </shadow>
                                                        </value>
                                                      </block>
                                                    </value>
                                                  </block>
                                                </value>
                                                <next>
                                                  <block type="update" id="pspG@Np(dcYEZk2{B0XZ">
                                                    <mutation xmlns="http://www.w3.org/1999/xhtml" delay_input="false"></mutation>
                                                    <field name="OID">0_userdata.0.wp.steuerung.sollTemp</field>
                                                    <field name="WITH_DELAY">FALSE</field>
                                                    <value name="VALUE">
                                                      <block type="get_value" id="jVb:7Cf+h/P:/[$!u,}]">
                                                        <field name="ATTR">val</field>
                                                        <field name="OID">0_userdata.0.wp.steuerung.pvZielTemp</field>
                                                      </block>
                                                    </value>
                                                  </block>
                                                </next>
                                              </block>
                                            </statement>
                                          </block>
                                        </next>
                                      </block>
                                    </next>
                                  </block>
                                </next>
                              </block>
                            </next>
                          </block>
                        </next>
                      </block>
                    </statement>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </next>
      </block>
    </statement>
  </block>
  <block type="procedures_defnoreturn" id="u)I{pfrtFB4mf20OTr?c" x="2638" y="-1637">
    <field name="NAME">virtuelleWallbox</field>
    <comment pinned="false" h="80" w="160">Describe this function...</comment>
    <statement name="STACK">
      <block type="on_ext" id="PHX%6Q_Pw,FhHyE4CgHj">
        <mutation xmlns="http://www.w3.org/1999/xhtml" items="1"></mutation>
        <field name="CONDITION">any</field>
        <field name="ACK_CONDITION"></field>
        <value name="OID0">
          <shadow type="field_oid" id="YgUQ.ut)][WlfKqddQvo">
            <field name="oid">0_userdata.0.wp.evcc.aktivierbar</field>
          </shadow>
        </value>
        <statement name="STATEMENT">
          <block type="controls_if" id="Jw8Z3;b{ey{LEdJPp.g4">
            <mutation else="1"></mutation>
            <value name="IF0">
              <block type="logic_compare" id="{d245sPIAgq97qvn9~,)">
                <field name="OP">EQ</field>
                <value name="A">
                  <block type="get_value_var" id="7LCe4hPZg;0B,TbTmkq8">
                    <field name="ATTR">val</field>
                    <value name="OID">
                      <shadow type="field_oid" id="KT#7;ebN71vezr$?.Rhv">
                        <field name="oid">0_userdata.0.wp.evcc.aktivierbar</field>
                      </shadow>
                    </value>
                  </block>
                </value>
                <value name="B">
                  <block type="logic_boolean" id="{(.=iBAfz=tG1/f8|N@)">
                    <field name="BOOL">TRUE</field>
                  </block>
                </value>
              </block>
            </value>
            <statement name="DO0">
              <block type="debug" id=":m]C.ot*4ep@Um!(!G|s">
                <field name="Severity">info</field>
                <value name="TEXT">
                  <shadow type="text" id="rzB-2iop]r15MLY2n2ML">
                    <field name="TEXT">Wärmepumpe wird aktiviert, starte Überladen Wasserspeicher</field>
                  </shadow>
                </value>
                <next>
                  <block type="comment" id="LIvbz7lL?55z*F)-g:^i">
                    <field name="COMMENT">Ladevorgang durch evcc gestartet,&amp;#10;Steuerwerte für evcc setzen</field>
                    <next>
                      <block type="update" id="(l49L@SF~(Q8H-P|o.5:">
                        <mutation xmlns="http://www.w3.org/1999/xhtml" delay_input="false"></mutation>
                        <field name="OID">0_userdata.0.wp.evcc.aktiv</field>
                        <field name="WITH_DELAY">FALSE</field>
                        <value name="VALUE">
                          <block type="logic_boolean" id="jRN+:D3pMRgvI~eV*0Wh">
                            <field name="BOOL">TRUE</field>
                          </block>
                        </value>
                        <next>
                          <block type="update" id="i#S^`FoB#Z=[Hnx9Po{z">
                            <mutation xmlns="http://www.w3.org/1999/xhtml" delay_input="false"></mutation>
                            <field name="OID">0_userdata.0.wp.evcc.ladestatus</field>
                            <field name="WITH_DELAY">FALSE</field>
                            <value name="VALUE">
                              <block type="text" id="bwO3S[F4[ZdU^*_9R}w9">
                                <field name="TEXT">C</field>
                              </block>
                            </value>
                            <next>
                              <block type="comment" id="K=cT{IaAylNkaiv{$sh]">
                                <field name="COMMENT">überhöhte Wassertemperatur setzen</field>
                                <next>
                                  <block type="update" id="HjppqlH]xZ`,;%4O{-7C">
                                    <mutation xmlns="http://www.w3.org/1999/xhtml" delay_input="false"></mutation>
                                    <field name="OID">0_userdata.0.wp.steuerung.sollTemp</field>
                                    <field name="WITH_DELAY">FALSE</field>
                                    <value name="VALUE">
                                      <block type="get_value" id="yB7qhCM)S{zB)gL=`Wc]">
                                        <field name="ATTR">val</field>
                                        <field name="OID">0_userdata.0.wp.steuerung.pvZielTemp</field>
                                      </block>
                                    </value>
                                  </block>
                                </next>
                              </block>
                            </next>
                          </block>
                        </next>
                      </block>
                    </next>
                  </block>
                </next>
              </block>
            </statement>
            <statement name="ELSE">
              <block type="debug" id="nV-C2fa+DW4-,0a?27]W">
                <field name="Severity">info</field>
                <value name="TEXT">
                  <shadow type="text" id="gP++HmsrL)eX*5JYX`TT">
                    <field name="TEXT">Wärmepumpe wird deaktiviert, stoppe Überladen Wasserspeicher</field>
                  </shadow>
                </value>
                <next>
                  <block type="comment" id="H+uAvnidr(L8*fPa*WDh">
                    <field name="COMMENT">Ladevorgang durch evcc beendet,&amp;#10;Steuerwerte für evcc setzen</field>
                    <next>
                      <block type="update" id="sOLFm}=CQ^+0I,!+G7?5">
                        <mutation xmlns="http://www.w3.org/1999/xhtml" delay_input="false"></mutation>
                        <field name="OID">0_userdata.0.wp.evcc.aktiv</field>
                        <field name="WITH_DELAY">FALSE</field>
                        <value name="VALUE">
                          <block type="logic_boolean" id="UD7|eb~*s@wH|)J*igXf">
                            <field name="BOOL">FALSE</field>
                          </block>
                        </value>
                        <next>
                          <block type="comment" id="8jDNbU7q[f?I$H.0`)6S">
                            <field name="COMMENT">Beim Beendes des Ladevorgangs wird die &amp;#10;Wärmepumpe von der "Wallbox" getrennt</field>
                            <next>
                              <block type="update" id="m_u,kt/){+/*3gSS.#SA">
                                <mutation xmlns="http://www.w3.org/1999/xhtml" delay_input="false"></mutation>
                                <field name="OID">0_userdata.0.wp.evcc.ladestatus</field>
                                <field name="WITH_DELAY">FALSE</field>
                                <value name="VALUE">
                                  <block type="text" id="7}P=%!+-pUZX_V~os|OT">
                                    <field name="TEXT">A</field>
                                  </block>
                                </value>
                                <next>
                                  <block type="comment" id="0=$_c(i[0m=nW;/fC{^f">
                                    <field name="COMMENT">reguläre Temperatur Wasserspeicher setzen</field>
                                    <next>
                                      <block type="update" id="{M8?-J??251cUp|=5iad">
                                        <mutation xmlns="http://www.w3.org/1999/xhtml" delay_input="false"></mutation>
                                        <field name="OID">0_userdata.0.wp.steuerung.sollTemp</field>
                                        <field name="WITH_DELAY">FALSE</field>
                                        <value name="VALUE">
                                          <block type="get_value" id="7%H@k~z(QoKLE,;}Ia`-">
                                            <field name="ATTR">val</field>
                                            <field name="OID">0_userdata.0.wp.steuerung.stdTemp</field>
                                          </block>
                                        </value>
                                        <next>
                                          <block type="comment" id="r%ytXmHjXi%D]a])h5cL">
                                            <field name="COMMENT">Nach 6 Steuerzyklen (60 sec) kann die Wärmpeumpe&amp;#10;erneut zum Überschussladen verwendet werden</field>
                                            <next>
                                              <block type="timeouts_wait" id="N$drzXz_gJ`}HPYsNsK)">
                                                <field name="DELAY">60</field>
                                                <field name="UNIT">sec</field>
                                                <next>
                                                  <block type="update" id="YY|h(=so*MB]EUVkOhG4">
                                                    <mutation xmlns="http://www.w3.org/1999/xhtml" delay_input="false"></mutation>
                                                    <field name="OID">0_userdata.0.wp.evcc.ladestatus</field>
                                                    <field name="WITH_DELAY">FALSE</field>
                                                    <value name="VALUE">
                                                      <block type="text" id="!0[ggk(tj#!D/Yke1|Zf">
                                                        <field name="TEXT">B</field>
                                                      </block>
                                                    </value>
                                                    <next>
                                                      <block type="procedures_callnoreturn" id="lBJ#vYs@TjPgR[dekLdF">
                                                        <mutation name="setzeEVCCLimit"></mutation>
                                                      </block>
                                                    </next>
                                                  </block>
                                                </next>
                                              </block>
                                            </next>
                                          </block>
                                        </next>
                                      </block>
                                    </next>
                                  </block>
                                </next>
                              </block>
                            </next>
                          </block>
                        </next>
                      </block>
                    </next>
                  </block>
                </next>
              </block>
            </statement>
          </block>
        </statement>
      </block>
    </statement>
  </block>
  <block type="procedures_defnoreturn" id="^%B8U8bd1d[W/q4`G#i_" x="2638" y="-637">
    <field name="NAME">heizstabSteuerwerte</field>
    <comment pinned="false" h="80" w="160">Beschreibe diese Funktion …</comment>
    <statement name="STACK">
      <block type="comment" id="]6C7;;-Ztm0qt]HSMuC6">
        <field name="COMMENT">Kenndaten des Heizstabs - hier ein 6 kW Heizstab&amp;#10;mit 3 Phasen. Pro Phase hat der Heizstab eine &amp;#10;Leistung von 2 kW. Der Heizstab ist damit "nur"&amp;#10;in 3 Stufen mit 2 kW, 4 kW und 6kW steuerbar.&amp;#10;Durch Rundung und Leistungstoleranzen ergeben&amp;#10;sich die angegeben Werte. Als Warmwassertemperatur&amp;#10;wird ein Überladen auf 70 Grad angenommen. Die&amp;#10;maximale Wassertemperatur hängt vom Speichertank&amp;#10;sowie der Heizstableistung ab - Systemgrenzen bitte&amp;#10;beachten.</field>
        <next>
          <block type="variables_set" id=")b|f$K_ty$-?d9#SS=I~">
            <field name="VAR" id="C8mTNM`|x~:|Orh++t0y">HSMaxWasserTemp</field>
            <value name="VALUE">
              <block type="math_number" id="[~j,HPUN$o7FM+FiiB[r">
                <field name="NUM">70</field>
              </block>
            </value>
            <next>
              <block type="variables_set" id="u.)igtkHd5/yNqSM=lJR">
                <field name="VAR" id="4`clKl%KG#^(bLX;,Xtp">HSPhase1MinAmp</field>
                <value name="VALUE">
                  <block type="math_number" id="*QgOS*SjxF#^uG%x?sFm">
                    <field name="NUM">10</field>
                  </block>
                </value>
                <next>
                  <block type="variables_set" id="YyIy57L9i^L|Zl#.|}Sp">
                    <field name="VAR" id="L$T!0K2-^(e~!qBXBi0s">HSPhase1Power</field>
                    <value name="VALUE">
                      <block type="math_number" id="*%3VsQs#1Jdqj!}^4SV6">
                        <field name="NUM">2100</field>
                      </block>
                    </value>
                    <next>
                      <block type="variables_set" id=",AFE;(t5cP=F0^NrxG*`">
                        <field name="VAR" id="1OvO)X~V14KD:xfok%T!">HSPhase2MinAmp</field>
                        <value name="VALUE">
                          <block type="math_number" id="KGjy@H=qw53bp!6._Ki+">
                            <field name="NUM">19</field>
                          </block>
                        </value>
                        <next>
                          <block type="variables_set" id="`|12Chco/6K^3Swm8t}C">
                            <field name="VAR" id="~xer5k=`D^{c4_=4VeGS">HSPhase2Power</field>
                            <value name="VALUE">
                              <block type="math_number" id="vU55X+G8A[?%G19UkBD(">
                                <field name="NUM">4200</field>
                              </block>
                            </value>
                            <next>
                              <block type="variables_set" id="/TL138OB!d(i3FuPO/ZB">
                                <field name="VAR" id="a=Typ3-}y,q=i7Ycjl4c">HSPhase3MinAmp</field>
                                <value name="VALUE">
                                  <block type="math_number" id=":0g$YXNNB[L8b~V*q%L8">
                                    <field name="NUM">28</field>
                                  </block>
                                </value>
                                <next>
                                  <block type="variables_set" id="xrlJjTMr_.5#aI,1yO|2">
                                    <field name="VAR" id="I4s6=lWR3f-*4+.4|9xe">HSPhase3Power</field>
                                    <value name="VALUE">
                                      <block type="math_number" id=":%yu`0QkDtSNw2ynIycT">
                                        <field name="NUM">6300</field>
                                      </block>
                                    </value>
                                  </block>
                                </next>
                              </block>
                            </next>
                          </block>
                        </next>
                      </block>
                    </next>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </next>
      </block>
    </statement>
  </block>
  <block type="procedures_defnoreturn" id="-M{b{mwVFQTepz$uc?Z9" x="3063" y="-637">
    <field name="NAME">steuerungHeizstab</field>
    <comment pinned="false" h="88" w="406">Grundgerüst zur Steuerung eines Heizstabs. Die Idee muss an die eigenen Geräte angepasst werden. Die Steuerung wird durch ein hinzufügen zur Startmethode aktiviert.</comment>
    <statement name="STACK">
      <block type="procedures_callnoreturn" id="r1l-a`L$-(+-IM03U@:V">
        <mutation name="heizstabSteuerwerte"></mutation>
        <next>
          <block type="comment" id=")R?oGcbetBN%4Ix6Uz)6">
            <field name="COMMENT">Ist ein Heizstab stufenlos über einen &amp;#10;Leistungsregler stufenlos steuerbar, erfolgt die&amp;#10;Steurung in der Regel über ein PWm Signal mit &amp;#10;256 Stufen. Die "Berechnung" der Steuerstufe&amp;#10;erfolgt an dieser Stelle analog.</field>
            <next>
              <block type="on_ext" id="Sf$0L^8n=@V,a[uk=6En">
                <mutation xmlns="http://www.w3.org/1999/xhtml" items="1"></mutation>
                <field name="CONDITION">ne</field>
                <field name="ACK_CONDITION"></field>
                <value name="OID0">
                  <shadow type="field_oid" id="5vF?C9(3|G{I~YGMjhaV">
                    <field name="oid">0_userdata.0.wp.evcc.aktiv</field>
                  </shadow>
                </value>
                <statement name="STATEMENT">
                  <block type="variables_set" id="]Y7M{(^lz[E-FAkWWer6">
                    <field name="VAR" id="{mX-z64|*k%oT%HqOzhw">maximaleLeistungInAmp</field>
                    <value name="VALUE">
                      <block type="get_value" id="HO?1l[971`V2.2s}m9W%">
                        <field name="ATTR">val</field>
                        <field name="OID">0_userdata.0.wp.evcc.maxStromstaerke</field>
                      </block>
                    </value>
                    <next>
                      <block type="controls_if" id="T6*UF~V(65Z_Vq,qW.^^">
                        <value name="IF0">
                          <block type="get_value" id="5){yuDi~2ixBAbJ;lbfz">
                            <field name="ATTR">val</field>
                            <field name="OID">0_userdata.0.wp.evcc.aktiv</field>
                          </block>
                        </value>
                        <statement name="DO0">
                          <block type="comment" id="eUrY`*K`JePihTI=9@NQ">
                            <field name="COMMENT">Schalte z.B. über eine Shelly 3 Pro&amp;#10;die Phasen 1 - 3 von einem Heizstab an.&amp;#10;Ober setzte (neue) Datenpunkte, die per mqtt an &amp;#10;Shelly Datenpunkte gebunden sind und diese (indirekt schalten) schalten.&amp;#10;mqtt Topics könnten sein:&amp;#10;home/hs/steuerung/phase1&amp;#10;home/hs/steuerung/phase2&amp;#10;home/hs/steuerung/phase3</field>
                            <next>
                              <block type="controls_if" id="?QaI|iUQ-WT=^SVaC:rG">
                                <mutation elseif="2" else="1"></mutation>
                                <value name="IF0">
                                  <block type="logic_compare" id=",LJJQRG^u7UK;H*X4M?s">
                                    <field name="OP">GT</field>
                                    <value name="A">
                                      <block type="variables_get" id="pZ$hwY1|ypJ?Ev=`yioE">
                                        <field name="VAR" id="{mX-z64|*k%oT%HqOzhw">maximaleLeistungInAmp</field>
                                      </block>
                                    </value>
                                    <value name="B">
                                      <block type="variables_get" id="L7#$|ELaErn#uYHsiWSI">
                                        <field name="VAR" id="a=Typ3-}y,q=i7Ycjl4c">HSPhase3MinAmp</field>
                                      </block>
                                    </value>
                                  </block>
                                </value>
                                <statement name="DO0">
                                  <block type="variables_set" id="jNQz;J_EfM@b$o.,CrpQ">
                                    <field name="VAR" id="ZYeI5,BS5,V;#%*nOn-D">shellyPhase1</field>
                                    <value name="VALUE">
                                      <block type="logic_boolean" id="ezni.ZN+qP/VI]qP9!DK">
                                        <field name="BOOL">TRUE</field>
                                      </block>
                                    </value>
                                    <next>
                                      <block type="variables_set" id="b]^`Wly2l[.sn/GTYGYv">
                                        <field name="VAR" id="qFPXGo7y[`5eTSBChG-+">shellyPhase2</field>
                                        <value name="VALUE">
                                          <block type="logic_boolean" id="2RbLb;LbP5rg6u^9ud26">
                                            <field name="BOOL">TRUE</field>
                                          </block>
                                        </value>
                                        <next>
                                          <block type="variables_set" id="K-2n)*:i_%RbbG[nhGJ5">
                                            <field name="VAR" id="kxHc7?.FxviTyh[T8:Ta">shellyPhase3</field>
                                            <value name="VALUE">
                                              <block type="logic_boolean" id="E:Xr;8IXrvvI{vh,9f_f">
                                                <field name="BOOL">TRUE</field>
                                              </block>
                                            </value>
                                          </block>
                                        </next>
                                      </block>
                                    </next>
                                  </block>
                                </statement>
                                <value name="IF1">
                                  <block type="logic_compare" id="TzZdtf|ofZWh~tJ=Jn+b">
                                    <field name="OP">GT</field>
                                    <value name="A">
                                      <block type="variables_get" id="sx/a%.g*ybibOG(5s0oA">
                                        <field name="VAR" id="{mX-z64|*k%oT%HqOzhw">maximaleLeistungInAmp</field>
                                      </block>
                                    </value>
                                    <value name="B">
                                      <block type="variables_get" id="w3DfWB$WA8uELj-#bG}3">
                                        <field name="VAR" id="1OvO)X~V14KD:xfok%T!">HSPhase2MinAmp</field>
                                      </block>
                                    </value>
                                  </block>
                                </value>
                                <statement name="DO1">
                                  <block type="variables_set" id="~0Fzdnl%$m=3c$M83=pe">
                                    <field name="VAR" id="ZYeI5,BS5,V;#%*nOn-D">shellyPhase1</field>
                                    <value name="VALUE">
                                      <block type="logic_boolean" id="}+{r.pH*Y{gqn#e,srA:">
                                        <field name="BOOL">TRUE</field>
                                      </block>
                                    </value>
                                    <next>
                                      <block type="variables_set" id="4Pp8WIBdhV-V)yKE(UG3">
                                        <field name="VAR" id="qFPXGo7y[`5eTSBChG-+">shellyPhase2</field>
                                        <value name="VALUE">
                                          <block type="logic_boolean" id=",P3i9#4*iX~Bi85dSY[(">
                                            <field name="BOOL">TRUE</field>
                                          </block>
                                        </value>
                                        <next>
                                          <block type="variables_set" id="+iA.LHWI!o@S:=3!]9uK">
                                            <field name="VAR" id="kxHc7?.FxviTyh[T8:Ta">shellyPhase3</field>
                                            <value name="VALUE">
                                              <block type="logic_boolean" id="|QP1E]0L{V61;V2k[A.T">
                                                <field name="BOOL">FALSE</field>
                                              </block>
                                            </value>
                                          </block>
                                        </next>
                                      </block>
                                    </next>
                                  </block>
                                </statement>
                                <value name="IF2">
                                  <block type="logic_compare" id="b;7I3P9!A/wF@/ss*jJ3">
                                    <field name="OP">GT</field>
                                    <value name="A">
                                      <block type="variables_get" id="HKnpX%}@iG6NY_MCaMT2">
                                        <field name="VAR" id="{mX-z64|*k%oT%HqOzhw">maximaleLeistungInAmp</field>
                                      </block>
                                    </value>
                                    <value name="B">
                                      <block type="variables_get" id="{EvAWfQIP}OJGjuT}{`$">
                                        <field name="VAR" id="4`clKl%KG#^(bLX;,Xtp">HSPhase1MinAmp</field>
                                      </block>
                                    </value>
                                  </block>
                                </value>
                                <statement name="DO2">
                                  <block type="variables_set" id="4[7?r=K558wODn/88nik">
                                    <field name="VAR" id="ZYeI5,BS5,V;#%*nOn-D">shellyPhase1</field>
                                    <value name="VALUE">
                                      <block type="logic_boolean" id=";;#AnUrGTK+A9N3k9J|m">
                                        <field name="BOOL">TRUE</field>
                                      </block>
                                    </value>
                                    <next>
                                      <block type="variables_set" id="E!SPbn:g9mW:SFs0t=X9">
                                        <field name="VAR" id="qFPXGo7y[`5eTSBChG-+">shellyPhase2</field>
                                        <value name="VALUE">
                                          <block type="logic_boolean" id=".^T`]015B0;y(3(^UX=5">
                                            <field name="BOOL">FALSE</field>
                                          </block>
                                        </value>
                                        <next>
                                          <block type="variables_set" id="rse{Vs)r$YMCEDYoyti=">
                                            <field name="VAR" id="kxHc7?.FxviTyh[T8:Ta">shellyPhase3</field>
                                            <value name="VALUE">
                                              <block type="logic_boolean" id="GCLP4fih1iiaH6oy2ieU">
                                                <field name="BOOL">FALSE</field>
                                              </block>
                                            </value>
                                          </block>
                                        </next>
                                      </block>
                                    </next>
                                  </block>
                                </statement>
                                <statement name="ELSE">
                                  <block type="variables_set" id="}W:2$Vn$D_X*@(m7@n/`">
                                    <field name="VAR" id="ZYeI5,BS5,V;#%*nOn-D">shellyPhase1</field>
                                    <value name="VALUE">
                                      <block type="logic_boolean" id="bGyhB}RRYF8f[]+~$Ld$">
                                        <field name="BOOL">FALSE</field>
                                      </block>
                                    </value>
                                    <next>
                                      <block type="variables_set" id="|AAlsw/W17O.z34FukXA">
                                        <field name="VAR" id="qFPXGo7y[`5eTSBChG-+">shellyPhase2</field>
                                        <value name="VALUE">
                                          <block type="logic_boolean" id="U@$z]vvUzZKIKYfob(R.">
                                            <field name="BOOL">FALSE</field>
                                          </block>
                                        </value>
                                        <next>
                                          <block type="variables_set" id="^u_(),K9n{60Yv2{g8)8">
                                            <field name="VAR" id="kxHc7?.FxviTyh[T8:Ta">shellyPhase3</field>
                                            <value name="VALUE">
                                              <block type="logic_boolean" id=")[lBe,Tm71eCwGjnqa``">
                                                <field name="BOOL">FALSE</field>
                                              </block>
                                            </value>
                                          </block>
                                        </next>
                                      </block>
                                    </next>
                                  </block>
                                </statement>
                              </block>
                            </next>
                          </block>
                        </statement>
                      </block>
                    </next>
                  </block>
                </statement>
              </block>
            </next>
          </block>
        </next>
      </block>
    </statement>
  </block>
  <block type="procedures_defnoreturn" id="Jq1K.U=4@_@)qYZ-6Zn5" x="1463" y="-187">
    <field name="NAME">setzeEVCCLimit</field>
    <comment pinned="false" h="80" w="160">Beschreibe diese Funktion …</comment>
    <statement name="STACK">
      <block type="mqtt_sendmessage" id="W)90`#{[f/+Mq=4,j$*o">
        <field name="INSTANCE"></field>
        <field name="RETAIN">FALSE</field>
        <value name="TOPIC">
          <shadow type="text" id="L=4zGL.?r#a$7%Y4*c6W">
            <field name="TEXT">evcc/loadpoints/3/limitSoc/set</field>
          </shadow>
          <block type="text_join" id="humHH+@FD$e/%5FGRRA|">
            <mutation items="3"></mutation>
            <value name="ADD0">
              <block type="text" id="fldh)L5}GMNf.#9]c03@">
                <field name="TEXT">evcc/loadpoints/</field>
              </block>
            </value>
            <value name="ADD1">
              <block type="variables_get" id="8271Ni^G^Y4ksL:21Cak">
                <field name="VAR" id="1|QG.GkR.?Y6p=i^f4)5">evccLoadPointID</field>
              </block>
            </value>
            <value name="ADD2">
              <block type="text" id="*1*/Mhr-ea1dZLYYLDgV">
                <field name="TEXT">/limitSoc/set</field>
              </block>
            </value>
          </block>
        </value>
        <value name="MESSAGE">
          <shadow type="text" id="OvW/vy[h_9vVf8o`})18">
            <field name="TEXT">your message</field>
          </shadow>
          <block type="convert_tostring" id="KTsy;MTuq57`YhXt{q6[">
            <value name="VALUE">
              <block type="get_value" id="0*;5y]gvlh,wM#~_~/[,">
                <field name="ATTR">val</field>
                <field name="OID">0_userdata.0.wp.steuerung.pvZielTemp</field>
              </block>
            </value>
          </block>
        </value>
      </block>
    </statement>
  </block>
</xml>